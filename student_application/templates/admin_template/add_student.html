{% extends 'hod_template/base_template.html' %}

{% block page_title %}
    Add Student
{% endblock page_title %}

{% block main_content %}
    {% load static %}             
             
        
                <!-- Main content -->
              
                    <div class="container-fluid">
                        <div class="row">
                            <!-- left column -->
                            <div class="col-md-12">
                                <!-- general form elements -->
                                <div class="card card-primary">
                                    <div class="card-header">
                                        <h3 class="card-title">Add Students</h3>
                                    </div>
                                    
                                    <form method="POST" enctype="multipart/form-data" action="{% url 'add_student_save' %}">
                                        {% csrf_token %}
                                        <div class="card-body">
                                          
                                                <div class="form-row">
                                                    <div class="col-md-12">                                                      
                                                        
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <h4>Student Information</h4>
                                                                </div>
                                                            </div>
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="first_name">First Name</label>
                                                                        <input type="text" class="form-control" id="first_name" name="first_name" required>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="last_name">Last Name</label>
                                                                        <input type="text" class="form-control" id="last_name" name="last_name" required>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="surname">Surname</label>
                                                                        <input type="text" class="form-control" id="surname" name="surname" required>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="gender">Gender</label>
                                                                        <select class="form-control" id="gender" name="gender" required>
                                                                            <option value="">Select Gender</option>
                                                                            <option value="Male">Male</option>
                                                                            <option value="Female">Female</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="date_of_birth">Date of Birth</label>
                                                                        <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" required>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="address">Address</label>
                                                                        <input type="text" class="form-control" id="address" name="address" required>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="phone_number">Phone Number</label>
                                                                        <input type="text" class="form-control" id="phone_number" name="phone_number" maxlength="15">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="school_segment">School Education Level</label>
                                                                        <select class="form-control" id="school_segment" name="school_segment" required>
                                                                            <option value="">Select Education Level</option>
                                                                            <option value="Nursery">Nursery</option>
                                                                            <option value="Primary">Primary</option>
                                                                            <option value="Secondary">Secondary</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="current_class">Current Class</label>
                                                                        <select class="form-control" id="current_class" name="current_class" required>
                                                                            <option value="">Select Class</option>
                                                                            <!-- Options will be populated dynamically based on the selected school segment -->
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="birth_certificate_id">Birth Certificate ID</label>
                                                                        <input type="text" class="form-control" id="birth_certificate_id" name="birth_certificate_id" required>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="birth_certificate_photo">Birth Certificate Photo</label>
                                                                        <input type="file" class="form-control" id="birth_certificate_photo" name="birth_certificate_photo"  accept=".pdf"   data-max-size="5242880">
                                                                        <small class="form-text  text-danger" style="color: red;">Accepted formats: PDF | Maximum file size: 5MB</small>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="allergies">Allergies</label>
                                                                        <input type="text" class="form-control" id="allergies" name="allergies">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="current_year">Current Year</label>
                                                                        <input type="number" class="form-control" id="current_year" name="current_year">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="is_finished">Is Finished</label>
                                                                        <select class="form-control" id="is_finished" name="is_finished">
                                                                            <option value="">Select</option>
                                                                            <option value="False">Yes</option>
                                                                            <option value="True">No</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="sheia_address">Sheia Address</label>
                                                                        <input type="text" class="form-control" id="sheia_address" name="sheia_address">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="street_address">Street Address</label>
                                                                        <input type="text" class="form-control" id="street_address" name="street_address">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="house_number">House Number</label>
                                                                        <input type="text" class="form-control" id="house_number" name="house_number">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="health_status">Health Status</label>
                                                                        <input type="text" class="form-control" id="health_status" name="health_status">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="physical_disability">Physical Disability</label>
                                                                        <input type="text" class="form-control" id="physical_disability" name="physical_disability">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="student_photo">Student Photo</label>
                                                                        <input type="file" class="form-control" id="student_photo" name="student_photo"   accept=".jpg, .jpeg, .png" data-max-size="5242880">
                                                                        <small class="form-text text-danger">Accepted formats: JPG, JPEG, PNG | Maximum file size: 5MB</small>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="service_type">Type of service</label>
                                                                        <select class="form-control" id="service_type" name="service_type" required>
                                                                            <option value="">Select service you want</option>
                                                                            <option value="school">School</option>
                                                                            <option value=" School and Madrasa "> School and Madrasa </option>                                                                            
                                                                            <option value="School, Madrasa and Transpont">School, Madrasa and Transpont</option>
                                                                            <option value="School and Transpont">School and Transpont</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="subjects">Subjects</label>
                                                                        <select class="form-control" id="subjects" name="subjects" required=required multiple>
                                                                            <option value="">Select subjects</option>
                                                                            {% for subject in all_subjects %}
                                                                                <option value="{{ subject.id }}">{{ subject.subject_name }}</option>
                                                                            {% endfor %}
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            
                                                     
                                                        
                                                   
                                                    </div>
                                                            <div class="form-row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="session_year">Session Year</label>
                                                                        <select class="form-control" id="session_year" name="session_year" required>
                                                                            <option value="">Select session year</option>
                                                                            {% for session_year in all_session_years %}
                                                                                <option value="{{ session_year.id }}">{{ session_year.session_start_year|date:'Y' }} - {{ session_year.session_end_year|date:'Y' }}</option>
                                                                            {% endfor %}
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            
                                                     
                                                        
                                                   
                                                    </div>
                                                </div>
                                      
                                        </div>
                                        <div class="card-footer">
                                            <div class="form-row">
                                                <div>
                                                    {% if messages %}
                                                        <div class="col-12">
                                                            {% for message in messages %}
                                                                {% if message.tags == 'error' %}
                                                                    <div class="alert alert-danger">{{ message }}</div>
                                                                {% elif message.tags == 'success' %}
                                                                    <div class="alert alert-primary">{{ message }}</div>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col-md-12">
                                                    <button type="submit" class="btn btn-primary btn-block">Add Student</button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <!--/.col (right) -->
                            </div>
                        </div>
                    </div>
            
                <!-- /.content -->
     
    
 

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function() {
            var segmentSelect = $('#school_segment');
            var classSelect = $('#current_class');
        
            classSelect.prop('disabled', true);
        
            segmentSelect.change(function() {
                var selectedSegment = $(this).val();
                classSelect.empty().prop('disabled', true);
        
                if (selectedSegment) {
                    $.ajax({
                        url: '{% url "get_class_choices" %}',
                        data: {
                            segment: selectedSegment
                        },
                        dataType: 'json',
                        success: function(response) {
                            console.log(response);
                            if (response.choices) {
                                $.each(response.choices, function(key, value) {
                                    classSelect.append($('<option>').text(value[1]).attr('value', value[0]));
                                        
                                });
                                classSelect.prop('disabled', false);
                            }
                        }
                    });
                }
            });
        
            // Manually trigger the change event on page load if a segment is already selected
            segmentSelect.trigger('change');
        });
    </script>
{% endblock main_content %}
